# Phase 4 ‚Äì Windows Server Deployment (Lab Domain Controller)

### üìö Purpose
Introduce a real Windows Server into the homelab environment for Active Directory, DNS, DHCP, and eventual attacker simulation.

---

### üõ†Ô∏è Environment Specs

| Component     | Value                                  |
|---------------|----------------------------------------|
| **OS**        | Windows Server 2022 Eval               |
| **CPU**       | 2 vCPUs                                |
| **RAM**       | 4 GB (6 GB recommended)                |
| **Disk**      | 45 GB                                  |
| **Networking**| VLAN 1 or isolated VLAN                |
| **Roles**     | AD DS, DNS, DHCP Server                |

---

### ‚úÖ Step-by-Step Installation

#### ‚úâÔ∏è Step 1: Download Required ISOs

- **Windows Server 2022 Evaluation**  
  üëâ https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2022

- **VirtIO ISO for Proxmox Drivers**  
  üëâ https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/latest-virtio/

---

#### üìÅ Step 2: Create the VM in Proxmox

- **Create new VM**
  - Name: `WIN-SRV-DC01`
  - OS Type: Microsoft Windows

- **Mount ISOs**
  - CD-ROM 1: Windows Server ISO
  - CD-ROM 2: VirtIO Drivers ISO

- **VM Settings**
  - CPU: 2 cores
  - RAM: 4096 MB (6144 MB optional)
  - Disk: 45 GB (VirtIO/SCSI)
  - Network: VirtIO adapter

---

#### üåê Step 3: Install Windows Server

1. Boot into the Windows Server ISO  
2. At the disk screen, load drivers from VirtIO ISO:  
   - Path: `/viostor/w10/amd64/`  
3. Proceed with install:
   - Choose "Desktop Experience"
   - Set admin password

---

#### üß≤ Step 4: Post-Install Tasks

- **Created AD Accounts**:
  - `Reuben Fernandes` (standard privileges)
  - `RF Admin` (added to Domain Admins group)

- **Disabled DHCP on VLAN 20 in pfSense**:
  - Location: `Services > DHCP Server > VLAN 20`
  - Action: DHCP disabled to prevent conflicts

- **Configured DHCP in Windows Server**:
  - **Scope Name**: `VLAN 20`
  - **IP Range**: `10.10.20.100 ‚Äì 10.10.20.120`
  - **Default Gateway**: `10.10.20.254`
  - **Status**: Scope successfully activated

- **Populated Active Directory with Test Users** (via PowerShell):
  - Users: Alice Doe, Bob Smith, Daisy Johnson, Evan Lee, Fiona Clark, George Hall, Hannah Lewis
  - OU Target: `OU=Users,DC=reuben,DC=local`
  - Bulk user creation used secure passwords and `PasswordNeverExpires = true`

<details>
<summary>üñ•Ô∏è PowerShell Script</summary>

```powershell
# Import Active Directory module
Import-Module ActiveDirectory

# User array (excluding manually created users)
$users = @(
    @{Name="Alice Doe"; Username="adoe"; Password="A1ice@Lab"; Role="Test User"},
    @{Name="Bob Smith"; Username="bsmith"; Password="B0b@Lab23"; Role="Test User"},
    @{Name="Daisy Johnson"; Username="djohnson"; Password="D@1syL@b"; Role="Test User"},
    @{Name="Evan Lee"; Username="elee"; Password="E!vanLab3"; Role="Test User"},
    @{Name="Fiona Clark"; Username="fclark"; Password="F1ona@Lab"; Role="Test User"},
    @{Name="George Hall"; Username="ghall"; Password="G¬£eorge55"; Role="Test User"},
    @{Name="Hannah Lewis"; Username="hlewis"; Password="H@nnah89"; Role="Test User"}
)

# Modify these to match your lab environment
$OU = "OU=Users,DC=reuben,DC=local"
$domain = "reuben.local"

# Bulk user creation loop
foreach ($user in $users) {
    $securePass = ConvertTo-SecureString $user.Password -AsPlainText -Force

    New-ADUser `
        -Name $user.Name `
        -GivenName ($user.Name.Split(' ')[0]) `
        -Surname ($user.Name.Split(' ')[-1]) `
        -SamAccountName $user.Username `
        -UserPrincipalName "$($user.Username)@$domain" `
        -AccountPassword $securePass `
        -Path $OU `
        -Enabled $true `
        -ChangePasswordAtLogon $false `
        -PasswordNeverExpires $true

    Write-Host "Created user: $($user.Username)"
}
```
</details>

---

> ‚úÖ At this stage, Windows Server is now a functioning Domain Controller with DNS, DHCP, and user accounts provisioned. The environment is ready for client joins, Group Policy testing, and log forwarding configuration in the next phase.
